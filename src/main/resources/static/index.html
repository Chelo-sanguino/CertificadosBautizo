<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Certificados</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        #form-bautizo { background-color: #f8f9fa; padding: 30px; margin: 30px; border-radius: 10px; }
        input, textarea { width: calc(50% - 10px); padding: 12px; margin: 5px; border: 2px solid #e0e0e0; border-radius: 5px; }
        textarea { width: calc(100% - 10px); resize: vertical; }
        .search-bar { padding: 0 30px; display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { width: 100%; }
        button { padding: 12px 25px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; }
        .btn-guardar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-buscar { background: #667eea; }
        .btn-pdf { background: #28a745; }
        .btn-editar { background: #ffc107; color: #333; }
        .btn-eliminar { background: #dc3545; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; }
        td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>‚õ™ Gesti√≥n de Certificados</h1>
            <p>Sistema Parroquial</p>
        </header>

        <div id="form-bautizo">
            <h3 id="form-titulo" style="color:#667eea; margin-bottom:15px;">üìù Nuevo Registro</h3>
            <input type="hidden" id="bautizo-id">
            
            <input type="text" id="ci" placeholder="C.I. / Documento de Identidad (Obligatorio)" style="background-color: #fffde7; border-color: #ffeb3b; font-weight: bold;">
            <br>
            
            <input type="text" id="nombreBautizado" placeholder="Nombre Bautizado">
            <input type="text" id="apellidoBautizado" placeholder="Apellido Bautizado">
            <input type="date" id="fechaBautizo" title="Fecha de Bautizo">
            <br>
            <input type="text" id="nombrePadre" placeholder="Nombre Padre">
            <input type="text" id="nombreMadre" placeholder="Nombre Madre">
            <br>
            <input type="text" id="nombrePadrino" placeholder="Nombre Padrino">
            <input type="text" id="nombreMadrina" placeholder="Nombre Madrina">
            <br>
            <textarea id="observaciones" rows="2" placeholder="Observaciones..."></textarea>
            
            <div style="margin-top: 15px;">
                <button class="btn-guardar" onclick="guardarBautizo()">üíæ Guardar</button>
                <button class="btn-cancelar" onclick="limpiarFormulario()" style="display:none; background:#6c757d;" id="btn-cancelar">‚ùå Cancelar</button>
            </div>
        </div>

        <h2 style="padding: 0 30px; color: #667eea;">üìã Lista de Registros</h2>

        <div class="search-bar">
            <input type="text" id="buscador" class="search-input" placeholder="Buscar por nombre o apellido..." onkeyup="if(event.key === 'Enter') cargarBautizos()">
            <button class="btn-buscar" onclick="cargarBautizos()">üîç Buscar</button>
        </div>
        
        <div style="padding: 0 30px 30px 30px; overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Documento (CI)</th>
                        <th>Bautizado</th>
                        <th>Fecha</th>
                        <th>Padres</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tabla-bautizos-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api/bautizos';

        window.onload = cargarBautizos;

        async function cargarBautizos() {
            const busqueda = document.getElementById('buscador').value;
            let url = API_URL;
            if(busqueda) {
                url += `?buscar=${encodeURIComponent(busqueda)}`;
            }

            try {
                const response = await fetch(url);
                const bautizos = await response.json();
                const tbody = document.getElementById('tabla-bautizos-body');
                tbody.innerHTML = '';

                bautizos.forEach(b => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${b.id}</td>
                            <td><strong>${b.ci || 'S/N'}</strong></td>
                            <td>${b.nombreBautizado} ${b.apellidoBautizado}</td>
                            <td>${b.fechaBautizo || '-'}</td>
                            <td><small>${b.nombrePadre || ''} y ${b.nombreMadre || ''}</small></td>
                            <td style="white-space:nowrap;">
                                <button class="btn-pdf" onclick="descargarPdf(${b.id})">üìÑ</button>
                                <button class="btn-editar" onclick="editar(${b.id})">‚úèÔ∏è</button>
                                <button class="btn-eliminar" onclick="eliminar(${b.id})">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (e) { console.error(e); }
        }

        async function guardarBautizo() {
            const id = document.getElementById('bautizo-id').value;
            const datos = {
                ci: document.getElementById('ci').value,
                nombreBautizado: document.getElementById('nombreBautizado').value,
                apellidoBautizado: document.getElementById('apellidoBautizado').value,
                fechaBautizo: document.getElementById('fechaBautizo').value,
                nombrePadre: document.getElementById('nombrePadre').value,
                nombreMadre: document.getElementById('nombreMadre').value,
                nombrePadrino: document.getElementById('nombrePadrino').value,
                nombreMadrina: document.getElementById('nombreMadrina').value,
                observaciones: document.getElementById('observaciones').value
            };

            if (!datos.ci || !datos.nombreBautizado || !datos.apellidoBautizado) {
                alert('‚ö†Ô∏è El CI, Nombre y Apellido son obligatorios');
                return;
            }

            let url = API_URL;
            let metodo = 'POST';
            if (id) { url += `/${id}`; metodo = 'PUT'; }

            try {
                const response = await fetch(url, {
                    method: metodo,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });

                if (response.ok) {
                    alert('‚úÖ Guardado con √©xito');
                    limpiarFormulario();
                    cargarBautizos();
                } else {
                    const mensaje = await response.text();
                    alert(mensaje); 
                }
            } catch (e) { alert('‚ùå Error de conexi√≥n'); }
        }

        async function editar(id) {
            const res = await fetch(`${API_URL}/${id}`);
            const b = await res.json();
            document.getElementById('bautizo-id').value = b.id;
            document.getElementById('ci').value = b.ci || '';
            document.getElementById('nombreBautizado').value = b.nombreBautizado;
            document.getElementById('apellidoBautizado').value = b.apellidoBautizado;
            document.getElementById('fechaBautizo').value = b.fechaBautizo;
            document.getElementById('nombrePadre').value = b.nombrePadre;
            document.getElementById('nombreMadre').value = b.nombreMadre;
            document.getElementById('nombrePadrino').value = b.nombrePadrino;
            document.getElementById('nombreMadrina').value = b.nombreMadrina;
            document.getElementById('observaciones').value = b.observaciones || '';
            
            document.getElementById('form-titulo').innerText = `‚úèÔ∏è Editando ID: ${b.id}`;
            document.getElementById('btn-cancelar').style.display = 'inline-block';
            window.scrollTo(0,0);
        }

        async function eliminar(id) {
            if(confirm('¬øEliminar registro?')) {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                cargarBautizos();
            }
        }

        function descargarPdf(id) { window.location.href = `${API_URL}/${id}/pdf`; }

        function limpiarFormulario() {
            document.querySelectorAll('input, textarea').forEach(i => i.value = '');
            document.getElementById('form-titulo').innerText = 'üìù Nuevo Registro';
            document.getElementById('btn-cancelar').style.display = 'none';
        }
    </script>
</body>
</html>